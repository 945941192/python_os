		
        {% extends 'base/base.html' %}
        {% block title %}检测日志{% endblock %}
        {% block content %}

			<div class="am-u-md-41" style="overflow:auto;" id="contents">
                <form enctype="multipart/form-data" id="forms" action="{% url 'check:upload_check_tarball' %}" method="post">  
                    <br/>
                    <br/>
                    <br/>
                    <input type="file"  id="Myfile" name="tarball" /> 
                    <br/>
                    <div>
                        <h4 style="display:inline-block;">添加备注 : </h4>
                        <textarea name="remarks" style="width:426px;height:80px;"></textarea>
                    </div>
                    <br/>  
                    <input class="btn btn-success" id="showLoadingDiv" onclick="submit" type="button" value="upload"/>  
                </form> 

                    <br/>
                    <br/>
                        <table id="example" class="display" cellspacing="0" width="100%">
                            <thead>                         
                            <tr>                            
                                <th style="text-align:center;width:20%"> tarball info</th>                
                                <th style="text-align:center;width:5%">report</th>      
                                <th style="text-align:center;width:5%">tarball</th>      
                                <th style="text-align:center;width:30%">时间</th>                   
                                <th id="test" style="text-align:center;width:40%"> 备注信息</th>                
                            </tr>                           
                            </thead>                                                                                                                                               
                            <tbody>                         
                            {%for info in tarball_set%}     
                                <tr>                            
                                    <td style="text-align:center;">{{info.file_name}}</td>
                                    {% if info.check_status == 1 %}
                                        <td style="text-align:center;"><button class="btn btn-primary" type="button"  onclick="window.open('{{info.check_report_url}}')">查看</button></td>    
                                    {% else %}
                                        <td style="text-align:center;"><button class="btn btn-primary" type="button" disabled="disabled" onclick="window.open('{{info.check_report_url}}')">查看</button></td>    
                                    {% endif %}

                                    {% if info.check_status == 1 %}
                                        <td style="text-align:center;"><button class="btn btn-info" type="button" onclick="window.open('{{info.tarball_url}}')">下载</button></td>    
                                    {% else %}
                                        <td style="text-align:center;"><button class="btn btn-info" type="button" disables="disabled" onclick="window.open('{{info.tarball_url}}')">下载</button></td>    
                                    {% endif %}
                                    <td style="text-align:center;">{{ info.upload_time|date:"Y-m-d H:i:s" }}</td> 
                                    {% if info.remarks == '' %}
                                        <td>无</td>
                                    {% else %}
                                        <td class="remarks">{{info.remarks}}</td>
                                    {% endif %}
                                </tr>                           
                            {%endfor%}                      
                            </tbody>                        
                        </table>      

			</div>
            <div class="am-u-md-41" id="up_loading" style="text-align:center;margin-top: 211px;display:none"  align="center">
                <img src="/static/images/boy_loading.gif"  style="text-align:center" alt="system_process-img" class="img-rounded"> 
                <h3>   玩命上传中，请稍等。。。。。。</h3>
            </div>

        {% endblock %}

		



        {% block extrajs %}
		<script type="text/javascript">



        $(document).ready(function() {
            $("#showLoadingDiv").click(function(){
                var upload_file_name = $("#Myfile").val();
                var re_file_name = new RegExp(/\.tar\.gz$/);
                if (!upload_file_name){
                    alert("请选择要检测的tarball")
                }
                else if(!re_file_name.test(upload_file_name)){
                     alert("请输入正确的tarball 如:cloud_log.2017-10-20-16-54-51.tar.gz")   
                }
                else{
                    $("#contents").hide()
                    $("#up_loading").show()
                    $("#forms").submit();
                }
                });

///文本原样呈现

                $(".remarks").each(function(){
                    $(this).html($(this).text().replace(/\n/g,'<br>'))
                });

        });

        $(document).ready(function() {
            $('#example').DataTable( {
                "order": [[ 3, "desc"  ]]
            });
 
        });

    </script>
    {% endblock %}
